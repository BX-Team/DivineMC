From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: NONPLAYT <76615486+NONPLAYT@users.noreply.github.com>
Date: Sat, 1 Apr 2023 00:05:45 +0300
Subject: [PATCH] Paper PR - Deep clone unhandled nbt tags inside
 CraftMetaItem's constuctor


diff --git a/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java b/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java
index 7a4acbb32fbd600e629d0ec2e90868785320d822..7a0253782d8c699fcea929a7051fe3705e25ccc2 100644
--- a/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java
+++ b/src/main/java/org/bukkit/craftbukkit/inventory/CraftMetaItem.java
@@ -342,7 +342,7 @@ class CraftMetaItem implements ItemMeta, Damageable, Repairable, BlockDataMeta {
             this.destroyableKeys = new java.util.HashSet<>(meta.destroyableKeys);
         }
         // Paper end
-        this.unhandledTags.putAll(meta.unhandledTags);
+        meta.unhandledTags.forEach((key, tag) -> this.unhandledTags.put(key, tag.copy())); // Paper - Deep clone unhandled nbt tags
         this.persistentDataContainer.putAll(meta.persistentDataContainer.getRaw());
 
         this.internalTag = meta.internalTag;
